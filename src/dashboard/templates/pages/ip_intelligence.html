<!-- SSH Guardian v3.0 - IP Intelligence Page (Unified) -->
<div id="page-ip-intel" class="page-content" style="display: none;">
    <!-- Header -->
    <div class="page-header">
        <div>
            <h1 class="page-title">IP Intelligence</h1>
            <p class="page-subtitle">Comprehensive IP analysis with GeoIP, threat data, ML recommendations & history</p>
        </div>
        <div class="page-header-actions">
            <button class="ipi-btn ipi-btn-secondary" onclick="loadIPIntelPage()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
                Refresh
            </button>
        </div>
    </div>

    <!-- Stats Row -->
    <div class="ipi-stats-row">
        <div class="ipi-stat-card ipi-stat-blue">
            <div class="ipi-stat-icon">üåê</div>
            <div class="ipi-stat-content">
                <span class="ipi-stat-value" id="ipi-stat-total">-</span>
                <span class="ipi-stat-label">Tracked IPs</span>
            </div>
        </div>
        <div class="ipi-stat-card ipi-stat-red">
            <div class="ipi-stat-icon">‚ö†Ô∏è</div>
            <div class="ipi-stat-content">
                <span class="ipi-stat-value" id="ipi-stat-high-risk">-</span>
                <span class="ipi-stat-label">High Risk</span>
            </div>
        </div>
        <div class="ipi-stat-card ipi-stat-orange">
            <div class="ipi-stat-icon">üîí</div>
            <div class="ipi-stat-content">
                <span class="ipi-stat-value" id="ipi-stat-blocked">-</span>
                <span class="ipi-stat-label">Blocked</span>
            </div>
        </div>
        <div class="ipi-stat-card ipi-stat-purple">
            <div class="ipi-stat-icon">üïµÔ∏è</div>
            <div class="ipi-stat-content">
                <span class="ipi-stat-value" id="ipi-stat-threats">-</span>
                <span class="ipi-stat-label">VPN/Proxy/Tor</span>
            </div>
        </div>
    </div>

    <!-- IP Lookup Section -->
    <div class="ipi-card ipi-lookup-card">
        <div class="ipi-card-header">
            <div class="ipi-card-title">
                <span class="ipi-card-icon">üîç</span>
                IP Analysis
            </div>
            <div class="ipi-lookup-hint">Enter an IP address or click any IP from the table below</div>
        </div>
        <div class="ipi-card-body">
            <div class="ipi-lookup-form">
                <input type="text" id="ipi-search-input" placeholder="Enter IP address (e.g., 192.168.1.1)" onkeypress="if(event.key==='Enter')analyzeIP()">
                <button class="ipi-btn ipi-btn-primary" onclick="analyzeIP()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                    Analyze
                </button>
                <button class="ipi-btn ipi-btn-secondary" onclick="enrichIP()" title="Fetch fresh data from APIs">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
                    Enrich
                </button>
            </div>
            <div id="ipi-analysis-result"></div>
        </div>
    </div>

    <!-- IP History Table -->
    <div class="ipi-card ipi-table-card">
        <div class="ipi-card-header">
            <div class="ipi-card-title">
                <span class="ipi-card-icon">üìã</span>
                IP History
            </div>
            <div class="ipi-card-actions">
                <select id="ipi-filter-risk" onchange="loadIPHistory(1)">
                    <option value="">All Risk Levels</option>
                    <option value="high">High Risk</option>
                    <option value="medium">Medium Risk</option>
                    <option value="low">Low Risk</option>
                </select>
                <select id="ipi-filter-blocked" onchange="loadIPHistory(1)">
                    <option value="">All Status</option>
                    <option value="true">Blocked</option>
                    <option value="false">Not Blocked</option>
                </select>
                <div class="ipi-search-box">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                    <input type="text" id="ipi-search" placeholder="Search IP..." onkeyup="clearTimeout(window.ipiSearchTm);window.ipiSearchTm=setTimeout(()=>loadIPHistory(1),400)">
                </div>
            </div>
        </div>
        <div class="ipi-table-wrap" id="ipi-history-list">
            <div class="ipi-loading">Loading...</div>
        </div>
        <div class="ipi-card-footer" id="ipi-pagination"></div>
    </div>
</div>

<style>
/* IP Intelligence Page Styles */
#page-ip-intel {
    --ipi-blue: #0078D4;
    --ipi-green: #10b981;
    --ipi-orange: #f97316;
    --ipi-red: #ef4444;
    --ipi-purple: #8b5cf6;
    --ipi-cyan: #06b6d4;
}

/* Stats Row */
#page-ip-intel .ipi-stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 24px;
}

@media (max-width: 1100px) {
    #page-ip-intel .ipi-stats-row { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 600px) {
    #page-ip-intel .ipi-stats-row { grid-template-columns: 1fr; }
}

#page-ip-intel .ipi-stat-card {
    background: var(--surface);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    border: 1px solid var(--border);
    position: relative;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
}

#page-ip-intel .ipi-stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.08);
}

#page-ip-intel .ipi-stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 4px;
}

#page-ip-intel .ipi-stat-blue::before { background: linear-gradient(90deg, #0078D4, #00a2ff); }
#page-ip-intel .ipi-stat-red::before { background: linear-gradient(90deg, #ef4444, #f87171); }
#page-ip-intel .ipi-stat-orange::before { background: linear-gradient(90deg, #f97316, #fb923c); }
#page-ip-intel .ipi-stat-purple::before { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }

#page-ip-intel .ipi-stat-icon {
    width: 52px; height: 52px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    background: var(--background);
    flex-shrink: 0;
}

#page-ip-intel .ipi-stat-content {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

#page-ip-intel .ipi-stat-value {
    font-size: 28px;
    font-weight: 700;
    line-height: 1.1;
}

#page-ip-intel .ipi-stat-blue .ipi-stat-value { color: var(--ipi-blue); }
#page-ip-intel .ipi-stat-red .ipi-stat-value { color: var(--ipi-red); }
#page-ip-intel .ipi-stat-orange .ipi-stat-value { color: var(--ipi-orange); }
#page-ip-intel .ipi-stat-purple .ipi-stat-value { color: var(--ipi-purple); }

#page-ip-intel .ipi-stat-label {
    font-size: 13px;
    color: var(--text-secondary);
    font-weight: 500;
}

/* Cards */
#page-ip-intel .ipi-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 20px;
}

#page-ip-intel .ipi-card-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
    background: linear-gradient(to bottom, var(--surface), var(--background));
}

#page-ip-intel .ipi-card-title {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 15px;
    font-weight: 600;
}

#page-ip-intel .ipi-card-icon { font-size: 18px; }

#page-ip-intel .ipi-lookup-hint {
    font-size: 12px;
    color: var(--text-secondary);
}

#page-ip-intel .ipi-card-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

#page-ip-intel .ipi-card-actions select {
    padding: 8px 12px;
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 13px;
    background: var(--surface);
    cursor: pointer;
}

#page-ip-intel .ipi-search-box {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--surface);
}

#page-ip-intel .ipi-search-box svg {
    color: var(--text-secondary);
    flex-shrink: 0;
}

#page-ip-intel .ipi-search-box input {
    border: none;
    background: none;
    font-size: 13px;
    width: 140px;
    outline: none;
}

#page-ip-intel .ipi-card-body { padding: 20px; }
#page-ip-intel .ipi-card-footer {
    padding: 14px 20px;
    border-top: 1px solid var(--border);
    background: var(--background);
}

/* Buttons */
#page-ip-intel .ipi-btn {
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.15s;
}

#page-ip-intel .ipi-btn-primary {
    background: var(--ipi-blue);
    color: white;
}

#page-ip-intel .ipi-btn-primary:hover {
    background: #106ebe;
    transform: translateY(-1px);
}

#page-ip-intel .ipi-btn-secondary {
    background: var(--surface);
    color: var(--text-primary);
    border: 1px solid var(--border);
}

#page-ip-intel .ipi-btn-secondary:hover {
    background: var(--background);
}

/* Lookup Form */
#page-ip-intel .ipi-lookup-form {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

#page-ip-intel .ipi-lookup-form input {
    flex: 1;
    max-width: 400px;
    padding: 12px 16px;
    border: 2px solid var(--border);
    border-radius: 10px;
    font-size: 14px;
    background: var(--background);
    transition: border-color 0.2s;
}

#page-ip-intel .ipi-lookup-form input:focus {
    outline: none;
    border-color: var(--ipi-blue);
}

/* Analysis Result */
#page-ip-intel .ipi-result {
    border-radius: 12px;
    border: 1px solid var(--border);
    overflow: hidden;
}

#page-ip-intel .ipi-result-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    padding: 16px 20px;
    background: linear-gradient(to right, var(--background), var(--surface));
    border-bottom: 1px solid var(--border);
}

#page-ip-intel .ipi-result-ip-info {
    display: flex;
    align-items: center;
    gap: 14px;
}

#page-ip-intel .ipi-result-flag { font-size: 32px; }

#page-ip-intel .ipi-result-ip {
    font-size: 22px;
    font-weight: 700;
    font-family: 'SF Mono', monospace;
    color: var(--ipi-blue);
}

#page-ip-intel .ipi-result-location {
    font-size: 13px;
    color: var(--text-secondary);
    margin-top: 2px;
}

#page-ip-intel .ipi-result-badges {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

#page-ip-intel .ipi-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
}

#page-ip-intel .ipi-badge-critical { background: #fef2f2; color: #991b1b; }
#page-ip-intel .ipi-badge-high { background: #fff7ed; color: #c2410c; }
#page-ip-intel .ipi-badge-medium { background: #fefce8; color: #a16207; }
#page-ip-intel .ipi-badge-low { background: #f0fdf4; color: #166534; }
#page-ip-intel .ipi-badge-blocked { background: #fee2e2; color: #b91c1c; }
#page-ip-intel .ipi-badge-private { background: #e0f2fe; color: #0369a1; }
#page-ip-intel .ipi-badge-safe { background: #d1fae5; color: #065f46; }
#page-ip-intel .ipi-badge-proxy { background: #fef3c7; color: #b45309; }
#page-ip-intel .ipi-badge-vpn { background: #dbeafe; color: #1d4ed8; }
#page-ip-intel .ipi-badge-tor { background: #f3e8ff; color: #7c3aed; }

#page-ip-intel .ipi-result-sections {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1px;
    background: var(--border);
}

#page-ip-intel .ipi-result-section {
    padding: 16px 20px;
    background: var(--surface);
}

#page-ip-intel .ipi-section-title {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-secondary);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

#page-ip-intel .ipi-section-title svg {
    width: 14px;
    height: 14px;
}

#page-ip-intel .ipi-data-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
}

#page-ip-intel .ipi-data-item {
    font-size: 13px;
}

#page-ip-intel .ipi-data-item strong {
    display: block;
    font-size: 11px;
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: 2px;
}

#page-ip-intel .ipi-score-bar {
    height: 8px;
    background: var(--background);
    border-radius: 4px;
    overflow: hidden;
    margin-top: 4px;
}

#page-ip-intel .ipi-score-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.3s;
}

#page-ip-intel .ipi-ml-recommendation {
    padding: 12px 16px;
    border-radius: 8px;
    background: var(--background);
    margin-top: 10px;
}

#page-ip-intel .ipi-ml-recommendation.threat {
    background: #fef2f2;
    border: 1px solid #fecaca;
}

#page-ip-intel .ipi-ml-recommendation.safe {
    background: #f0fdf4;
    border: 1px solid #bbf7d0;
}

/* Event History in Result */
#page-ip-intel .ipi-event-list {
    max-height: 200px;
    overflow-y: auto;
}

#page-ip-intel .ipi-event-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
}

#page-ip-intel .ipi-event-item:last-child { border-bottom: none; }

#page-ip-intel .ipi-event-type {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
}

#page-ip-intel .ipi-event-failed { background: #fee2e2; color: #b91c1c; }
#page-ip-intel .ipi-event-successful { background: #d1fae5; color: #065f46; }

/* Table */
#page-ip-intel .ipi-table-wrap { overflow-x: auto; }

#page-ip-intel .ipi-table {
    width: 100%;
    border-collapse: collapse;
}

#page-ip-intel .ipi-table th {
    text-align: left;
    padding: 14px 16px;
    font-weight: 600;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-secondary);
    background: var(--background);
    border-bottom: 2px solid var(--border);
    white-space: nowrap;
}

#page-ip-intel .ipi-table td {
    padding: 14px 16px;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
}

#page-ip-intel .ipi-table tbody tr {
    transition: background 0.15s;
    cursor: pointer;
}

#page-ip-intel .ipi-table tbody tr:hover {
    background: var(--background);
}

#page-ip-intel .ipi-table .ip-cell {
    font-family: 'SF Mono', 'Consolas', monospace;
    font-weight: 600;
    color: var(--ipi-blue);
}

#page-ip-intel .ipi-table .country-cell {
    display: flex;
    align-items: center;
    gap: 8px;
}

#page-ip-intel .ipi-table .flag { font-size: 18px; }

#page-ip-intel .ipi-tag {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
}

#page-ip-intel .ipi-tag-high { background: #fee2e2; color: #b91c1c; }
#page-ip-intel .ipi-tag-medium { background: #fef3c7; color: #b45309; }
#page-ip-intel .ipi-tag-low { background: #d1fae5; color: #065f46; }
#page-ip-intel .ipi-tag-private { background: #e0f2fe; color: #0369a1; }
#page-ip-intel .ipi-tag-blocked { background: #fecaca; color: #7f1d1d; }

/* Pagination */
#page-ip-intel .ipi-pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#page-ip-intel .ipi-pagination-info {
    font-size: 13px;
    color: var(--text-secondary);
}

#page-ip-intel .ipi-pagination-btns {
    display: flex;
    gap: 6px;
}

#page-ip-intel .ipi-pagination-btns button {
    min-width: 36px;
    height: 36px;
    padding: 0 12px;
    border: 1px solid var(--border);
    background: var(--surface);
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.15s;
}

#page-ip-intel .ipi-pagination-btns button:hover:not(:disabled) {
    background: var(--background);
    border-color: var(--ipi-blue);
}

#page-ip-intel .ipi-pagination-btns button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

#page-ip-intel .ipi-pagination-btns button.active {
    background: var(--ipi-blue);
    color: white;
    border-color: var(--ipi-blue);
}

/* Loading & Empty States */
#page-ip-intel .ipi-loading {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
    font-size: 14px;
}

#page-ip-intel .ipi-empty {
    text-align: center;
    padding: 50px 20px;
    color: var(--text-secondary);
}

#page-ip-intel .ipi-empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

#page-ip-intel .ipi-empty-text {
    font-size: 15px;
    font-weight: 500;
}

#page-ip-intel .ipi-error {
    text-align: center;
    padding: 30px 20px;
    color: var(--ipi-red);
    font-size: 14px;
}

/* Not Found State */
#page-ip-intel .ipi-not-found {
    padding: 20px;
    border-radius: 10px;
    background: #fffbeb;
    border: 1px solid #fef3c7;
    text-align: center;
}

#page-ip-intel .ipi-not-found-icon { font-size: 32px; margin-bottom: 10px; }
#page-ip-intel .ipi-not-found-title { font-weight: 600; color: #d97706; margin-bottom: 8px; }
#page-ip-intel .ipi-not-found-text { font-size: 13px; color: var(--text-secondary); margin-bottom: 16px; }

/* Score Breakdown Section */
#page-ip-intel .ipi-score-breakdown {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

#page-ip-intel .ipi-score-row {
    display: flex;
    align-items: center;
    gap: 12px;
}

#page-ip-intel .ipi-score-label {
    flex: 0 0 100px;
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
}

#page-ip-intel .ipi-score-bar-container {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 12px;
}

#page-ip-intel .ipi-score-bar-bg {
    flex: 1;
    height: 8px;
    background: var(--background);
    border-radius: 4px;
    overflow: hidden;
}

#page-ip-intel .ipi-score-bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.3s ease;
}

#page-ip-intel .ipi-score-value {
    flex: 0 0 50px;
    font-size: 12px;
    font-weight: 600;
    text-align: right;
}

/* Warning tag for network flags */
#page-ip-intel .ipi-tag-warning {
    background: #fef3c7;
    color: #b45309;
    padding: 2px 8px;
    font-size: 10px;
    border-radius: 4px;
    margin-right: 4px;
}
</style>
