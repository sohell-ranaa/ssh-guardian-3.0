<!-- SSH Guardian v3.0 - Attack Scenarios Page -->
<!-- Version: v3.4.0 - Tabbed Categories -->
<div id="page-simulation" class="page-content" style="display: none;">
    <div class="page-header-with-cache">
        <div>
            <h2 style="margin: 0 0 8px 0; color: var(--text-primary); font-size: 24px; font-weight: 600;">
                Attack Scenarios
            </h2>
            <p style="margin: 0; color: var(--text-secondary); font-size: 14px;">
                Run attack scenarios on your servers to test security rules
            </p>
        </div>
    </div>

    <!-- Target Server Selector Card -->
    <div class="card" style="margin-bottom: 16px; padding: 16px;">
        <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
            <div style="flex: 1; min-width: 250px;">
                <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px; color: var(--text-secondary);">Target Server</label>
                <select id="scenario-target" onchange="onSimulationTargetChange()" style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 4px; font-size: 14px; background: var(--surface);">
                    <option value="">-- Select a server --</option>
                </select>
            </div>
            <div style="display: flex; gap: 8px; align-items: flex-end;">
                <button onclick="showAddTargetModal()" style="padding: 8px 16px; background: var(--surface); border: 1px solid var(--border); border-radius: 4px; font-size: 13px; cursor: pointer;">
                    Manage Targets
                </button>
                <button id="refresh-ips-btn" class="refresh-btn" onclick="refreshIPPool()">
                    <span id="refresh-ips-icon" class="refresh-icon">‚Üª</span> Refresh IPs
                </button>
            </div>
        </div>
    </div>

    <!-- No Server Selected Placeholder -->
    <div id="simulationNoServer" class="card" style="text-align: center; padding: 60px 20px;">
        <div style="font-size: 48px; margin-bottom: 16px;">üéØ</div>
        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Select a Target Server</h3>
        <p style="color: var(--text-secondary); font-size: 14px;">Choose a target server from the dropdown to run attack scenarios.</p>
    </div>

    <!-- Simulation Content (hidden until server selected) -->
    <div id="simulationContent" style="display: none;">

        <!-- Category Tabs -->
        <div class="sim-category-tabs" style="display: flex; gap: 4px; margin-bottom: 16px; padding: 4px; background: var(--surface-alt); border-radius: 8px; border: 1px solid var(--border);">
            <button class="sim-cat-tab active" data-category="ufw_block" onclick="switchScenarioCategory('ufw_block')">
                <span class="sim-cat-tab-icon">üõ°Ô∏è</span>
                <span class="sim-cat-tab-label">UFW Block</span>
                <span class="sim-cat-tab-count" id="count-ufw">0</span>
            </button>
            <button class="sim-cat-tab" data-category="fail2ban" onclick="switchScenarioCategory('fail2ban')">
                <span class="sim-cat-tab-icon">üîí</span>
                <span class="sim-cat-tab-label">Fail2ban</span>
                <span class="sim-cat-tab-count" id="count-fail2ban">0</span>
            </button>
            <button class="sim-cat-tab" data-category="ml_behavioral" onclick="switchScenarioCategory('ml_behavioral')">
                <span class="sim-cat-tab-icon">üß†</span>
                <span class="sim-cat-tab-label">ML Behavioral</span>
                <span class="sim-cat-tab-count" id="count-ml">0</span>
            </button>
            <button class="sim-cat-tab" data-category="alert_only" onclick="switchScenarioCategory('alert_only')">
                <span class="sim-cat-tab-icon">‚ö†Ô∏è</span>
                <span class="sim-cat-tab-label">Alert Only</span>
                <span class="sim-cat-tab-count" id="count-alert">0</span>
            </button>
            <button class="sim-cat-tab" data-category="private_ip" onclick="switchScenarioCategory('private_ip')">
                <span class="sim-cat-tab-icon">üè†</span>
                <span class="sim-cat-tab-label">Private IP</span>
                <span class="sim-cat-tab-count" id="count-private">0</span>
            </button>
            <button class="sim-cat-tab" data-category="baseline" onclick="switchScenarioCategory('baseline')">
                <span class="sim-cat-tab-icon">‚úÖ</span>
                <span class="sim-cat-tab-label">Baseline</span>
                <span class="sim-cat-tab-count" id="count-baseline">0</span>
            </button>
        </div>

        <!-- Category Description -->
        <div id="category-description" class="card" style="padding: 12px 16px; margin-bottom: 16px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <span id="cat-desc-icon" style="font-size: 24px;">üõ°Ô∏è</span>
                <div style="flex: 1;">
                    <h4 id="cat-desc-title" style="margin: 0 0 4px 0; font-size: 15px; font-weight: 600;">UFW Blocking Scenarios</h4>
                    <p id="cat-desc-text" style="margin: 0; font-size: 12px; color: var(--text-secondary);">Trigger SSH Guardian rules ‚Üí Agent blocks IP via UFW</p>
                </div>
                <span id="cat-desc-badge" style="display: none; padding: 4px 10px; font-size: 11px; font-weight: 600; border-radius: 4px;"></span>
            </div>
            <div id="cat-desc-steps" class="cat-steps-guide" style="display: none; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border);"></div>
        </div>

        <!-- Live Attack Status Panel -->
        <div id="live-attack-status" class="sim-card sim-card--bordered-blue" style="display: none; margin-bottom: 16px;">
            <div class="sim-card__header sim-card__header--running">
                <div class="sim-card__header-left">
                    <div id="live-status-spinner" class="sim-spinner"></div>
                    <div>
                        <div id="live-status-title" class="sim-card__header-title" style="font-size: 16px;">Simulation Running</div>
                        <p id="live-status-subtitle" class="sim-card__header-subtitle" style="margin: 4px 0 0 0; font-size: 12px;">Initializing...</p>
                    </div>
                </div>
                <button onclick="hideLiveStatus()" class="sim-card__close-btn" style="width: 32px; height: 32px; border-radius: 6px;">‚úï</button>
            </div>
            <div class="sim-card__section sim-card__section--surface">
                <div class="sim-timeline">
                    <div class="sim-timeline__line"></div>
                    <div id="live-progress-bar" class="sim-timeline__progress" style="width: 0%;"></div>
                    <div class="sim-timeline__step live-step-item" data-step="inject">
                        <div class="sim-timeline__circle">üì§</div>
                        <span class="sim-timeline__label">Inject</span>
                    </div>
                    <div class="sim-timeline__step live-step-item" data-step="detect">
                        <div class="sim-timeline__circle">üëÅÔ∏è</div>
                        <span class="sim-timeline__label">Detect</span>
                    </div>
                    <div class="sim-timeline__step live-step-item" data-step="analyze">
                        <div class="sim-timeline__circle">üîç</div>
                        <span class="sim-timeline__label">Analyze</span>
                    </div>
                    <div class="sim-timeline__step live-step-item" data-step="block">
                        <div class="sim-timeline__circle">üõ°Ô∏è</div>
                        <span class="sim-timeline__label">Block</span>
                    </div>
                    <div class="sim-timeline__step live-step-item" data-step="complete">
                        <div class="sim-timeline__circle">‚úÖ</div>
                        <span class="sim-timeline__label">Done</span>
                    </div>
                </div>
            </div>
            <div class="sim-card__section">
                <div class="sim-data-grid">
                    <div class="sim-data-item">
                        <div class="sim-data-item__label">Attack IP</div>
                        <div id="live-attack-ip" class="sim-data-item__value sim-data-item__value--mono sim-data-item__value--danger">-</div>
                    </div>
                    <div class="sim-data-item">
                        <div class="sim-data-item__label">Scenario</div>
                        <div id="live-scenario-name" class="sim-data-item__value">-</div>
                    </div>
                    <div class="sim-data-item">
                        <div class="sim-data-item__label">Expected Result</div>
                        <div id="live-expected-result" class="sim-data-item__value sim-data-item__value--info">-</div>
                    </div>
                </div>
            </div>
            <div id="live-log-section" class="sim-card__section" style="display: none;">
                <div class="sim-section-title">Activity Log</div>
                <div id="live-log" class="sim-activity-log"></div>
            </div>
        </div>

        <!-- Simulation Results Card -->
        <div id="simulation-results-card" class="sim-card" style="display: none; margin-bottom: 16px;">
            <div id="sim-results-header" class="sim-card__header sim-card__header--complete">
                <div class="sim-card__header-left">
                    <div id="sim-result-icon" class="sim-card__header-icon">üõ°Ô∏è</div>
                    <div>
                        <h3 id="sim-result-title" class="sim-card__header-title">IP BLOCKED</h3>
                        <p id="sim-result-subtitle" class="sim-card__header-subtitle">Attack successfully detected and blocked</p>
                    </div>
                </div>
                <button onclick="hideSimulationResults()" class="sim-card__close-btn">‚úï</button>
            </div>
            <div class="sim-card__section sim-card__section--surface">
                <div class="sim-summary-bar">
                    <div class="sim-summary-bar__item">
                        <span class="sim-summary-bar__label">IP Address:</span>
                        <span id="sim-result-ip" class="sim-summary-bar__value--ip">-</span>
                    </div>
                    <div class="sim-summary-bar__item">
                        <span class="sim-summary-bar__label">Scenario:</span>
                        <span id="sim-result-scenario" class="sim-summary-bar__value">-</span>
                    </div>
                    <div class="sim-summary-bar__item">
                        <span class="sim-summary-bar__label">Duration:</span>
                        <span id="sim-result-duration" class="sim-summary-bar__value">-</span>
                    </div>
                </div>
            </div>
            <div class="sim-card__body">
                <div class="sim-data-grid sim-data-grid--two-col">
                    <div>
                        <div class="sim-section-title"><span>üîç</span> Threat Intelligence</div>
                        <div class="sim-stat-rows">
                            <div class="sim-stat-row sim-stat-row--highlight">
                                <span class="sim-stat-row__label">AbuseIPDB Score</span>
                                <span id="sim-abuseipdb-score" class="sim-stat-row__value sim-data-item__value--danger">-</span>
                            </div>
                            <div class="sim-stat-row">
                                <span class="sim-stat-row__label">VirusTotal</span>
                                <span id="sim-virustotal" class="sim-stat-row__value">-</span>
                            </div>
                            <div class="sim-stat-row">
                                <span class="sim-stat-row__label">Country</span>
                                <span id="sim-country" class="sim-stat-row__value">-</span>
                            </div>
                            <div class="sim-stat-row">
                                <span class="sim-stat-row__label">Network Type</span>
                                <span id="sim-network-type" class="sim-stat-row__value">-</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="sim-section-title"><span>ü§ñ</span> ML Analysis</div>
                        <div class="sim-stat-rows">
                            <div class="sim-stat-row sim-stat-row--score">
                                <span class="sim-stat-row__label">Risk Score</span>
                                <span id="sim-ml-risk-score" class="sim-stat-row__value sim-stat-row__value--large sim-data-item__value--info">-</span>
                            </div>
                            <div class="sim-stat-row">
                                <span class="sim-stat-row__label">Threat Level</span>
                                <span id="sim-ml-threat-level" class="sim-stat-row__value">-</span>
                            </div>
                            <div class="sim-stat-row">
                                <span class="sim-stat-row__label">Decision</span>
                                <span id="sim-ml-decision" class="sim-stat-row__value">-</span>
                            </div>
                            <div class="sim-stat-row">
                                <span class="sim-stat-row__label">Confidence</span>
                                <span id="sim-ml-confidence" class="sim-stat-row__value">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sim-card__section sim-card__section--surface">
                <div class="sim-action-links">
                    <a href="/dashboard#firewall" class="sim-action-link sim-action-link--primary">üõ°Ô∏è View in Firewall</a>
                    <a href="/dashboard#events-live" class="sim-action-link sim-action-link--secondary">üì° View Live Events</a>
                    <a href="/dashboard#ip-intel" class="sim-action-link sim-action-link--secondary">üîç IP Intelligence</a>
                    <button onclick="hideSimulationResults()" class="sim-action-link sim-action-link--ghost">Close</button>
                </div>
            </div>
        </div>

        <!-- Scenarios Grid Container -->
        <div id="scenarios-container" class="card" style="padding: 16px;">
            <!-- IP Pool Status -->
            <div id="ip-pool-status" style="display: none; margin-bottom: 12px; padding: 8px 12px; background: rgba(46, 164, 79, 0.1); border: 1px solid #2EA44F; border-radius: 6px; font-size: 12px;">
                <span id="ip-pool-count">0</span> fresh IPs available
                <span style="color: var(--text-secondary); margin-left: 8px;">Last refresh: <span id="ip-pool-time">Never</span></span>
            </div>

            <!-- Scenario Cards Grid -->
            <div id="scenarios-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 12px;">
                <!-- Scenarios loaded dynamically -->
            </div>

            <!-- Empty State -->
            <div id="scenarios-empty" style="display: none; text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                <div style="font-size: 32px; margin-bottom: 12px;">üì≠</div>
                <p>No scenarios in this category</p>
            </div>
        </div>

    </div> <!-- End simulationContent -->
</div>

<!-- Scenario Action Modal -->
<div id="scenario-action-modal" class="scenario-modal-overlay" style="display: none;">
    <div class="scenario-modal-box">
        <div class="scenario-modal-header">
            <div>
                <h3 id="scenario-modal-title">Scenario Name</h3>
                <p id="scenario-modal-subtitle">IP: 0.0.0.0 | User: username</p>
            </div>
            <button onclick="closeScenarioModal()" class="scenario-modal-close">√ó</button>
        </div>
        <div class="scenario-modal-body">
            <!-- Description -->
            <p id="scenario-modal-desc" class="scenario-modal-desc"></p>

            <!-- Target Server Warning -->
            <div id="scenario-no-target" class="scenario-no-target" style="display: none;">
                ‚ö†Ô∏è Select a target server first!
            </div>

            <!-- Editable Variables -->
            <div id="scenario-modal-vars" class="scenario-modal-vars">
                <div class="var-row">
                    <label class="var-label">IP Address:</label>
                    <input type="text" id="scenario-var-ip" class="var-input" value="8.8.8.8">
                </div>
                <div class="var-row">
                    <label class="var-label">Username:</label>
                    <input type="text" id="scenario-var-user" class="var-input" value="testuser">
                </div>
                <div class="var-row">
                    <label class="var-label">Auth Type:</label>
                    <select id="scenario-var-auth" class="var-input">
                        <option value="password">Password</option>
                        <option value="publickey">Public Key</option>
                        <option value="keyboard-interactive">Keyboard Interactive</option>
                    </select>
                </div>
                <div class="var-row">
                    <label class="var-label">Result:</label>
                    <select id="scenario-var-result" class="var-input">
                        <option value="Accepted">Accepted (Success)</option>
                        <option value="Failed">Failed (Invalid)</option>
                    </select>
                </div>
                <div class="var-row">
                    <label class="var-label">Event Count:</label>
                    <input type="number" id="scenario-var-count" class="var-input" value="1" min="1" max="50">
                </div>
                <div class="var-row">
                    <label class="var-label">Event Time:</label>
                    <input type="time" id="scenario-var-time" class="var-input" value="">
                    <span style="font-size: 11px; color: var(--text-secondary); margin-left: 8px;">Leave empty for current time</span>
                </div>
            </div>

            <!-- Expected Outcome -->
            <p id="scenario-modal-expected" class="scenario-modal-expected">Expected: UFW Block</p>

            <!-- Action Buttons (dynamic based on category) -->
            <div id="scenario-action-buttons" class="scenario-action-buttons">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>
</div>

<style>
/* Scenario Action Modal */
.scenario-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    padding: 20px;
}
.scenario-modal-box {
    background: var(--surface);
    border-radius: 12px;
    width: 100%;
    max-width: 420px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.2s ease;
}
@keyframes modalSlideIn {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
.scenario-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
}
.scenario-modal-header h3 {
    font-size: 16px;
    font-weight: 600;
    margin: 0 0 4px 0;
}
.scenario-modal-header p {
    font-size: 12px;
    color: var(--text-secondary);
    margin: 0;
    font-family: monospace;
}
.scenario-modal-close {
    width: 28px;
    height: 28px;
    border: 1px solid var(--border);
    background: var(--background);
    border-radius: 6px;
    font-size: 18px;
    cursor: pointer;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
}
.scenario-modal-close:hover {
    background: var(--border);
}
.scenario-modal-body {
    padding: 16px 20px 20px;
}
.scenario-modal-desc {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 12px;
    line-height: 1.5;
}
.scenario-no-target {
    background: rgba(230, 165, 2, 0.15);
    border: 1px solid #E6A502;
    color: #E6A502;
    padding: 10px 12px;
    border-radius: 6px;
    margin-bottom: 12px;
    font-size: 13px;
    font-weight: 500;
    text-align: center;
}
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}
.scenario-modal-vars {
    font-size: 12px;
    padding: 12px;
    background: var(--background);
    border-radius: 6px;
    margin-bottom: 12px;
}
.scenario-modal-vars .var-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 0;
}
.scenario-modal-vars .var-label {
    color: var(--text-secondary);
    font-size: 12px;
    min-width: 90px;
}
.scenario-modal-vars .var-input {
    flex: 1;
    padding: 6px 10px;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-size: 13px;
    font-family: monospace;
    background: var(--surface);
    color: var(--text-primary);
    max-width: 200px;
}
.scenario-modal-vars .var-input:focus {
    outline: none;
    border-color: var(--azure-blue);
}
.scenario-modal-expected {
    font-size: 12px;
    padding: 8px 12px;
    background: var(--background);
    border-radius: 6px;
    margin-bottom: 16px;
    color: var(--text-secondary);
}
.scenario-modal-expected.no-block {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid #10B981;
    color: #10B981;
}
.scenario-modal-expected.block {
    background: rgba(209, 52, 56, 0.1);
    border: 1px solid #D13438;
    color: #D13438;
}
.scenario-modal-expected.alert {
    background: rgba(230, 165, 2, 0.1);
    border: 1px solid #E6A502;
    color: #E6A502;
}
.scenario-action-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.scenario-action-btn {
    display: flex;
    align-items: center;
    gap: 14px;
    width: 100%;
    padding: 14px 16px;
    border: 2px solid var(--border);
    border-radius: 10px;
    background: var(--surface);
    cursor: pointer;
    text-align: left;
    transition: all 0.15s ease;
}
.scenario-action-btn:hover {
    border-color: var(--azure-blue);
    background: rgba(0, 120, 212, 0.05);
}
.scenario-action-btn.baseline:hover {
    border-color: #10B981;
    background: rgba(16, 185, 129, 0.05);
}
.scenario-action-btn.normal:hover {
    border-color: #0078D4;
    background: rgba(0, 120, 212, 0.05);
}
.scenario-action-btn.attack:hover {
    border-color: #D13438;
    background: rgba(209, 52, 56, 0.05);
}
.scenario-action-icon {
    font-size: 24px;
    width: 36px;
    text-align: center;
}
.scenario-action-text {
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.scenario-action-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
}
.scenario-action-desc {
    font-size: 11px;
    color: var(--text-secondary);
}
</style>

<style>
/* Category Tabs */
.sim-category-tabs {
    overflow-x: auto;
}
.sim-cat-tab {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: transparent;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
}
.sim-cat-tab:hover {
    background: var(--surface);
    color: var(--text-primary);
}
.sim-cat-tab.active {
    background: var(--azure-blue);
    color: white;
}
.sim-cat-tab-icon {
    font-size: 16px;
}
.sim-cat-tab-count {
    padding: 2px 8px;
    background: rgba(0,0,0,0.1);
    border-radius: 10px;
    font-size: 11px;
    font-weight: 600;
}
.sim-cat-tab.active .sim-cat-tab-count {
    background: rgba(255,255,255,0.2);
}

/* Category specific colors */
.sim-cat-tab[data-category="ml_behavioral"].active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
.sim-cat-tab[data-category="alert_only"].active {
    background: #E6A502;
}
.sim-cat-tab[data-category="baseline"].active {
    background: #2EA44F;
}
.sim-cat-tab[data-category="fail2ban"].active {
    background: #6366f1;
}
.sim-cat-tab[data-category="private_ip"].active {
    background: #8b5cf6;
}

/* Category Steps Guide */
.cat-steps-guide {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}
.cat-step {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    background: var(--surface-alt);
    border: 1px solid var(--border);
    border-radius: 16px;
    font-size: 11px;
    color: var(--text-secondary);
    white-space: nowrap;
}
.cat-step:first-child {
    color: var(--azure-blue);
    border-color: var(--azure-blue);
}
</style>

<!-- External CSS - Loaded via dashboard_modular.html -->
<!-- /static/css/pages/simulation.css -->

<!-- External JS - Loaded via dashboard_modular.html -->
<!-- /static/js/modules/simulation.js -->
