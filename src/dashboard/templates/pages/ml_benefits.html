<!-- SSH Guardian v3.0 - ML Benefits & Comparison Page -->
<div id="page-ml-benefits" class="page-content" style="display: none;">
    <div class="page-header">
        <div>
            <h2 style="margin: 0 0 8px 0; color: var(--text-primary); font-size: 24px; font-weight: 600;">
                ML Benefits & Comparison
            </h2>
            <p style="margin: 0; color: var(--text-secondary); font-size: 14px;">
                SSH Guardian ML vs Traditional Fail2Ban - Performance Analysis
            </p>
        </div>
    </div>

    <!-- Model Performance Overview -->
    <div class="benefits-section">
        <h3 class="benefits-section-title">Model Performance Metrics</h3>
        <div class="benefits-metrics-grid">
            <div class="benefits-metric-card">
                <div class="benefits-metric-value" id="b-accuracy">-</div>
                <div class="benefits-metric-label">Accuracy</div>
                <div class="benefits-metric-bar"><div class="benefits-metric-fill accuracy-fill" id="b-accuracy-bar"></div></div>
            </div>
            <div class="benefits-metric-card">
                <div class="benefits-metric-value" id="b-precision">-</div>
                <div class="benefits-metric-label">Precision</div>
                <div class="benefits-metric-bar"><div class="benefits-metric-fill precision-fill" id="b-precision-bar"></div></div>
            </div>
            <div class="benefits-metric-card">
                <div class="benefits-metric-value" id="b-recall">-</div>
                <div class="benefits-metric-label">Recall</div>
                <div class="benefits-metric-bar"><div class="benefits-metric-fill recall-fill" id="b-recall-bar"></div></div>
            </div>
            <div class="benefits-metric-card">
                <div class="benefits-metric-value" id="b-f1">-</div>
                <div class="benefits-metric-label">F1 Score</div>
                <div class="benefits-metric-bar"><div class="benefits-metric-fill f1-fill" id="b-f1-bar"></div></div>
            </div>
            <div class="benefits-metric-card">
                <div class="benefits-metric-value" id="b-auc">-</div>
                <div class="benefits-metric-label">ROC-AUC</div>
                <div class="benefits-metric-bar"><div class="benefits-metric-fill auc-fill" id="b-auc-bar"></div></div>
            </div>
            <div class="benefits-metric-card">
                <div class="benefits-metric-value" id="b-mcc">-</div>
                <div class="benefits-metric-label">MCC</div>
                <div class="benefits-metric-bar"><div class="benefits-metric-fill mcc-fill" id="b-mcc-bar"></div></div>
            </div>
        </div>
    </div>

    <!-- Two Column Layout: Confusion Matrix + Comparison -->
    <div class="benefits-two-col">
        <!-- Confusion Matrix -->
        <div class="benefits-section">
            <h3 class="benefits-section-title">Confusion Matrix Analysis</h3>
            <div class="benefits-cm-container">
                <div class="benefits-cm-grid" id="b-confusion-matrix">
                    <div class="benefits-cm-corner"></div>
                    <div class="benefits-cm-header">Predicted Benign</div>
                    <div class="benefits-cm-header">Predicted Threat</div>
                    <div class="benefits-cm-row-header">Actual Benign</div>
                    <div class="benefits-cm-cell tn" id="b-cm-tn">-</div>
                    <div class="benefits-cm-cell fp" id="b-cm-fp">-</div>
                    <div class="benefits-cm-row-header">Actual Threat</div>
                    <div class="benefits-cm-cell fn" id="b-cm-fn">-</div>
                    <div class="benefits-cm-cell tp" id="b-cm-tp">-</div>
                </div>
                <div class="benefits-cm-legend">
                    <div class="benefits-cm-legend-item"><span class="legend-dot tn"></span> True Negative (Correct)</div>
                    <div class="benefits-cm-legend-item"><span class="legend-dot tp"></span> True Positive (Correct)</div>
                    <div class="benefits-cm-legend-item"><span class="legend-dot fp"></span> False Positive (Type I Error)</div>
                    <div class="benefits-cm-legend-item"><span class="legend-dot fn"></span> False Negative (Type II Error)</div>
                </div>
                <div class="benefits-cm-stats" id="b-cm-stats"></div>
            </div>
        </div>

        <!-- SSH Guardian vs Fail2Ban -->
        <div class="benefits-section">
            <h3 class="benefits-section-title">SSH Guardian ML vs Fail2Ban</h3>
            <div class="benefits-comparison">
                <div class="benefits-compare-col fail2ban">
                    <div class="benefits-compare-header">
                        <span class="benefits-compare-name">Fail2Ban</span>
                        <span class="benefits-compare-badge reactive">Reactive</span>
                    </div>
                    <div class="benefits-compare-body">
                        <div class="benefits-compare-item negative">
                            <span class="benefits-compare-icon">✗</span>
                            <span>Blocks after <strong>5+ failed attempts</strong></span>
                        </div>
                        <div class="benefits-compare-item negative">
                            <span class="benefits-compare-icon">✗</span>
                            <span>Cannot correlate distributed attacks</span>
                        </div>
                        <div class="benefits-compare-item negative">
                            <span class="benefits-compare-icon">✗</span>
                            <span>No behavioral analysis</span>
                        </div>
                        <div class="benefits-compare-item negative">
                            <span class="benefits-compare-icon">✗</span>
                            <span>Static rules, no adaptation</span>
                        </div>
                        <div class="benefits-compare-item negative">
                            <span class="benefits-compare-icon">✗</span>
                            <span>High false positive rate</span>
                        </div>
                    </div>
                </div>
                <div class="benefits-compare-col guardian">
                    <div class="benefits-compare-header">
                        <span class="benefits-compare-name">SSH Guardian ML</span>
                        <span class="benefits-compare-badge proactive">Proactive</span>
                    </div>
                    <div class="benefits-compare-body">
                        <div class="benefits-compare-item positive">
                            <span class="benefits-compare-icon">✓</span>
                            <span>Detects on <strong>first attempt</strong></span>
                        </div>
                        <div class="benefits-compare-item positive">
                            <span class="benefits-compare-icon">✓</span>
                            <span>Correlates attacks across IPs</span>
                        </div>
                        <div class="benefits-compare-item positive">
                            <span class="benefits-compare-icon">✓</span>
                            <span><strong id="b-feature-count">50</strong> behavioral features</span>
                        </div>
                        <div class="benefits-compare-item positive">
                            <span class="benefits-compare-icon">✓</span>
                            <span>ML-based adaptive learning</span>
                        </div>
                        <div class="benefits-compare-item positive">
                            <span class="benefits-compare-icon">✓</span>
                            <span><strong id="b-fp-rate">-</strong> false positive rate</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Training Data & Cross-Validation -->
    <div class="benefits-two-col">
        <!-- Training Data Stats -->
        <div class="benefits-section">
            <h3 class="benefits-section-title">Training Data Summary</h3>
            <div class="benefits-training-stats">
                <div class="benefits-stat-row">
                    <span class="benefits-stat-label">Total Events</span>
                    <span class="benefits-stat-value" id="b-total-events">-</span>
                </div>
                <div class="benefits-stat-row">
                    <span class="benefits-stat-label">Training Samples (80%)</span>
                    <span class="benefits-stat-value" id="b-training-samples">-</span>
                </div>
                <div class="benefits-stat-row">
                    <span class="benefits-stat-label">Test Samples (20%)</span>
                    <span class="benefits-stat-value" id="b-test-samples">-</span>
                </div>
                <div class="benefits-stat-row">
                    <span class="benefits-stat-label">Benign Events</span>
                    <span class="benefits-stat-value benign" id="b-benign-count">-</span>
                </div>
                <div class="benefits-stat-row">
                    <span class="benefits-stat-label">Malicious Events</span>
                    <span class="benefits-stat-value malicious" id="b-malicious-count">-</span>
                </div>
                <div class="benefits-stat-row">
                    <span class="benefits-stat-label">Feature Count</span>
                    <span class="benefits-stat-value" id="b-features">-</span>
                </div>
                <div class="benefits-stat-row">
                    <span class="benefits-stat-label">Training Time</span>
                    <span class="benefits-stat-value" id="b-training-time">-</span>
                </div>
                <div class="benefits-stat-row">
                    <span class="benefits-stat-label">Inference Time</span>
                    <span class="benefits-stat-value" id="b-inference-time">-</span>
                </div>
            </div>
        </div>

        <!-- Cross-Validation Results -->
        <div class="benefits-section">
            <h3 class="benefits-section-title">Cross-Validation Results (5-Fold)</h3>
            <div class="benefits-cv-container">
                <div class="benefits-cv-folds" id="b-cv-folds"></div>
                <div class="benefits-cv-summary" id="b-cv-summary"></div>
            </div>
        </div>
    </div>

    <!-- Top Features -->
    <div class="benefits-section">
        <h3 class="benefits-section-title">Top Detection Features</h3>
        <p style="color: var(--text-secondary); font-size: 13px; margin: 0 0 16px 0;">
            The ML model uses these features to distinguish threats from legitimate access attempts
        </p>
        <div class="benefits-features-grid" id="b-features-list"></div>
    </div>

    <!-- Active Model Info -->
    <div class="benefits-section">
        <h3 class="benefits-section-title">Active Production Model</h3>
        <div class="benefits-model-info" id="b-model-info">
            <div class="benefits-model-stat">
                <div class="benefits-model-label">Model Name</div>
                <div class="benefits-model-value" id="b-model-name">-</div>
            </div>
            <div class="benefits-model-stat">
                <div class="benefits-model-label">Algorithm</div>
                <div class="benefits-model-value" id="b-algorithm">-</div>
            </div>
            <div class="benefits-model-stat">
                <div class="benefits-model-label">Version</div>
                <div class="benefits-model-value" id="b-version">-</div>
            </div>
            <div class="benefits-model-stat">
                <div class="benefits-model-label">Created</div>
                <div class="benefits-model-value" id="b-created">-</div>
            </div>
        </div>
    </div>
</div>

<style>
/* Benefits Page Styles */
.benefits-section {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}
.benefits-section-title {
    margin: 0 0 16px 0;
    font-size: 15px;
    font-weight: 600;
    color: var(--text-primary);
}

/* Two Column Layout */
.benefits-two-col {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}
@media (max-width: 900px) {
    .benefits-two-col { grid-template-columns: 1fr; }
}

/* Metrics Grid */
.benefits-metrics-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 16px;
}
@media (max-width: 1200px) { .benefits-metrics-grid { grid-template-columns: repeat(3, 1fr); } }
@media (max-width: 600px) { .benefits-metrics-grid { grid-template-columns: repeat(2, 1fr); } }

.benefits-metric-card {
    text-align: center;
    padding: 16px 12px;
    background: var(--background);
    border-radius: 8px;
}
.benefits-metric-value {
    font-size: 28px;
    font-weight: 700;
    color: #10b981;
    margin-bottom: 4px;
}
.benefits-metric-label {
    font-size: 11px;
    color: var(--text-secondary);
    text-transform: uppercase;
    margin-bottom: 8px;
}
.benefits-metric-bar {
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
}
.benefits-metric-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 0.5s ease;
}
.accuracy-fill { background: #10b981; }
.precision-fill { background: #3b82f6; }
.recall-fill { background: #8b5cf6; }
.f1-fill { background: #f59e0b; }
.auc-fill { background: #ec4899; }
.mcc-fill { background: #06b6d4; }

/* Confusion Matrix */
.benefits-cm-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
}
.benefits-cm-grid {
    display: grid;
    grid-template-columns: 100px 120px 120px;
    gap: 4px;
    text-align: center;
}
.benefits-cm-corner { background: transparent; }
.benefits-cm-header {
    padding: 10px 8px;
    background: var(--background);
    font-size: 11px;
    font-weight: 600;
    color: var(--text-secondary);
}
.benefits-cm-row-header {
    padding: 10px 8px;
    background: var(--background);
    font-size: 11px;
    font-weight: 600;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
}
.benefits-cm-cell {
    padding: 16px 8px;
    border-radius: 4px;
}
.benefits-cm-cell .cm-value {
    font-size: 22px;
    font-weight: 700;
}
.benefits-cm-cell .cm-pct {
    font-size: 11px;
    margin-top: 2px;
}
.benefits-cm-cell.tn { background: rgba(16, 185, 129, 0.15); }
.benefits-cm-cell.tn .cm-value { color: #10b981; }
.benefits-cm-cell.tp { background: rgba(16, 185, 129, 0.15); }
.benefits-cm-cell.tp .cm-value { color: #10b981; }
.benefits-cm-cell.fp { background: rgba(239, 68, 68, 0.15); }
.benefits-cm-cell.fp .cm-value { color: #ef4444; }
.benefits-cm-cell.fn { background: rgba(239, 68, 68, 0.15); }
.benefits-cm-cell.fn .cm-value { color: #ef4444; }

.benefits-cm-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
    font-size: 11px;
    color: var(--text-secondary);
}
.benefits-cm-legend-item {
    display: flex;
    align-items: center;
    gap: 4px;
}
.legend-dot {
    width: 10px;
    height: 10px;
    border-radius: 2px;
}
.legend-dot.tn, .legend-dot.tp { background: rgba(16, 185, 129, 0.5); }
.legend-dot.fp, .legend-dot.fn { background: rgba(239, 68, 68, 0.5); }

.benefits-cm-stats {
    font-size: 12px;
    color: var(--text-secondary);
    text-align: center;
}

/* Comparison */
.benefits-comparison {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}
.benefits-compare-col {
    border-radius: 8px;
    overflow: hidden;
}
.benefits-compare-col.fail2ban { background: rgba(239, 68, 68, 0.05); }
.benefits-compare-col.guardian { background: rgba(16, 185, 129, 0.05); }
.benefits-compare-header {
    padding: 12px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.benefits-compare-col.fail2ban .benefits-compare-header { background: rgba(239, 68, 68, 0.1); }
.benefits-compare-col.guardian .benefits-compare-header { background: rgba(16, 185, 129, 0.1); }
.benefits-compare-name {
    font-weight: 600;
    color: var(--text-primary);
}
.benefits-compare-badge {
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: 600;
}
.benefits-compare-badge.reactive { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
.benefits-compare-badge.proactive { background: rgba(16, 185, 129, 0.2); color: #10b981; }
.benefits-compare-body {
    padding: 12px 16px;
}
.benefits-compare-item {
    display: flex;
    gap: 8px;
    padding: 6px 0;
    font-size: 12px;
}
.benefits-compare-item.negative { color: #ef4444; }
.benefits-compare-item.positive { color: #10b981; }
.benefits-compare-icon {
    font-weight: 700;
    width: 16px;
}

/* Training Stats */
.benefits-training-stats {
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.benefits-stat-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 12px;
    background: var(--background);
    border-radius: 4px;
    font-size: 13px;
}
.benefits-stat-label { color: var(--text-secondary); }
.benefits-stat-value { font-weight: 600; color: var(--text-primary); }
.benefits-stat-value.benign { color: #10b981; }
.benefits-stat-value.malicious { color: #ef4444; }

/* Cross-Validation */
.benefits-cv-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
}
.benefits-cv-folds {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}
.benefits-cv-fold {
    flex: 1;
    min-width: 80px;
    text-align: center;
    padding: 12px 8px;
    background: var(--background);
    border-radius: 6px;
}
.benefits-cv-fold-label {
    font-size: 10px;
    color: var(--text-secondary);
    margin-bottom: 4px;
}
.benefits-cv-fold-value {
    font-size: 16px;
    font-weight: 700;
    color: #10b981;
}
.benefits-cv-summary {
    padding: 12px 16px;
    background: rgba(16, 185, 129, 0.1);
    border-radius: 6px;
    text-align: center;
    font-size: 14px;
}
.benefits-cv-summary strong { color: #10b981; }

/* Features Grid */
.benefits-features-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
}
@media (max-width: 700px) { .benefits-features-grid { grid-template-columns: 1fr; } }

.benefits-feature-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 12px;
    background: var(--background);
    border-radius: 4px;
}
.benefits-feature-rank {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--azure-blue);
    color: white;
    border-radius: 50%;
    font-size: 11px;
    font-weight: 600;
}
.benefits-feature-name {
    flex: 1;
    font-size: 12px;
    color: var(--text-primary);
}
.benefits-feature-bar-bg {
    width: 100px;
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    overflow: hidden;
}
.benefits-feature-bar {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6, #10b981);
    border-radius: 3px;
}
.benefits-feature-value {
    width: 50px;
    text-align: right;
    font-size: 11px;
    font-weight: 600;
    color: var(--text-secondary);
}

/* Model Info */
.benefits-model-info {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
}
@media (max-width: 800px) { .benefits-model-info { grid-template-columns: repeat(2, 1fr); } }

.benefits-model-stat {
    padding: 12px;
    background: var(--background);
    border-radius: 6px;
}
.benefits-model-label {
    font-size: 11px;
    color: var(--text-secondary);
    margin-bottom: 4px;
}
.benefits-model-value {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
}
</style>

<script>
(function() {
    'use strict';

    window.loadBenefitsReport = async function() {
        try {
            // Fetch from overview API which has all the data
            const res = await fetch('/api/ml/overview?refresh=1');
            const data = await res.json();

            if (data.success && data.overview && data.overview.active_model) {
                const m = data.overview.active_model;
                renderMetrics(m);
                renderConfusionMatrix(m);
                renderTrainingStats(m);
                renderCrossValidation(m);
                renderFeatures(m.feature_importance);
                renderModelInfo(m);
            }
        } catch (e) {
            console.error('Error loading benefits:', e);
        }
    };

    function renderMetrics(m) {
        const metrics = [
            { id: 'accuracy', value: m.accuracy },
            { id: 'precision', value: m.precision_score },
            { id: 'recall', value: m.recall_score },
            { id: 'f1', value: m.f1_score },
            { id: 'auc', value: m.auc_roc },
            { id: 'mcc', value: m.matthews_correlation, isMCC: true }
        ];

        metrics.forEach(metric => {
            const el = document.getElementById('b-' + metric.id);
            const bar = document.getElementById('b-' + metric.id + '-bar');
            if (el && metric.value) {
                const pct = metric.isMCC ? (parseFloat(metric.value) * 100) : (parseFloat(metric.value) * 100);
                el.textContent = pct.toFixed(2) + '%';
                if (bar) bar.style.width = Math.min(pct, 100) + '%';
            }
        });
    }

    function renderConfusionMatrix(m) {
        let tn, fp, fn, tp;
        if (m.confusion_matrix && Array.isArray(m.confusion_matrix)) {
            tn = m.confusion_matrix[0][0];
            fp = m.confusion_matrix[0][1];
            fn = m.confusion_matrix[1][0];
            tp = m.confusion_matrix[1][1];
        } else {
            tn = m.true_negatives;
            fp = m.false_positives;
            fn = m.false_negatives;
            tp = m.true_positives;
        }

        if (tn === undefined) return;

        const total = tn + fp + fn + tp;
        const correct = tn + tp;
        const errors = fp + fn;

        document.getElementById('b-cm-tn').innerHTML = `<div class="cm-value">${tn.toLocaleString()}</div><div class="cm-pct">${((tn/total)*100).toFixed(1)}%</div>`;
        document.getElementById('b-cm-fp').innerHTML = `<div class="cm-value">${fp.toLocaleString()}</div><div class="cm-pct">${((fp/total)*100).toFixed(1)}%</div>`;
        document.getElementById('b-cm-fn').innerHTML = `<div class="cm-value">${fn.toLocaleString()}</div><div class="cm-pct">${((fn/total)*100).toFixed(1)}%</div>`;
        document.getElementById('b-cm-tp').innerHTML = `<div class="cm-value">${tp.toLocaleString()}</div><div class="cm-pct">${((tp/total)*100).toFixed(1)}%</div>`;

        const statsEl = document.getElementById('b-cm-stats');
        if (statsEl) {
            statsEl.innerHTML = `
                Total: <strong>${total.toLocaleString()}</strong> samples |
                Correct: <strong style="color:#10b981">${correct.toLocaleString()}</strong> (${((correct/total)*100).toFixed(2)}%) |
                Errors: <strong style="color:#ef4444">${errors.toLocaleString()}</strong> (${((errors/total)*100).toFixed(2)}%)
            `;
        }

        // Update FP rate in comparison section
        const fpRate = ((fp / (fp + tn)) * 100).toFixed(2);
        const fpEl = document.getElementById('b-fp-rate');
        if (fpEl) fpEl.textContent = fpRate + '%';
    }

    function renderTrainingStats(m) {
        setText('b-total-events', m.total_events_generated?.toLocaleString() || '-');
        setText('b-training-samples', m.training_samples?.toLocaleString() || '-');
        setText('b-test-samples', m.testing_samples?.toLocaleString() || '-');
        setText('b-benign-count', m.benign_count?.toLocaleString() || '-');
        setText('b-malicious-count', m.malicious_count?.toLocaleString() || '-');
        setText('b-features', m.feature_count || '-');
        setText('b-feature-count', m.feature_count || '50');

        if (m.training_time_seconds) {
            const mins = (m.training_time_seconds / 60).toFixed(1);
            setText('b-training-time', mins + ' min');
        }
        if (m.prediction_time_ms) {
            setText('b-inference-time', parseFloat(m.prediction_time_ms).toFixed(2) + ' ms');
        }
    }

    function renderCrossValidation(m) {
        const foldsEl = document.getElementById('b-cv-folds');
        const summaryEl = document.getElementById('b-cv-summary');

        if (m.cv_scores && Array.isArray(m.cv_scores) && foldsEl) {
            foldsEl.innerHTML = m.cv_scores.map((score, i) => `
                <div class="benefits-cv-fold">
                    <div class="benefits-cv-fold-label">Fold ${i + 1}</div>
                    <div class="benefits-cv-fold-value">${(parseFloat(score) * 100).toFixed(2)}%</div>
                </div>
            `).join('');
        }

        if (m.cv_mean && m.cv_std && summaryEl) {
            const mean = (parseFloat(m.cv_mean) * 100).toFixed(2);
            const std = (parseFloat(m.cv_std) * 100).toFixed(2);
            summaryEl.innerHTML = `
                Cross-Validation Mean: <strong>${mean}%</strong> ± ${std}% (std)
                <br><span style="font-size:12px;color:var(--text-secondary);">Low standard deviation indicates consistent model performance across folds</span>
            `;
        }
    }

    function renderFeatures(features) {
        const container = document.getElementById('b-features-list');
        if (!container || !features) return;

        let featureArray = Array.isArray(features) ? features : Object.entries(features).map(([name, importance]) => ({ feature: name, importance }));
        featureArray.sort((a, b) => (b.importance || 0) - (a.importance || 0));

        const top10 = featureArray.slice(0, 10);
        const maxImportance = Math.max(...top10.map(f => f.importance || 0));

        container.innerHTML = top10.map((f, i) => {
            const name = (f.feature || f.name || '').replace(/_/g, ' ');
            const pct = maxImportance > 0 ? ((f.importance / maxImportance) * 100) : 0;
            const impPct = (f.importance * 100).toFixed(1);
            return `
                <div class="benefits-feature-item">
                    <div class="benefits-feature-rank">${i + 1}</div>
                    <div class="benefits-feature-name">${name}</div>
                    <div class="benefits-feature-bar-bg">
                        <div class="benefits-feature-bar" style="width: ${pct}%"></div>
                    </div>
                    <div class="benefits-feature-value">${impPct}%</div>
                </div>
            `;
        }).join('');
    }

    function renderModelInfo(m) {
        setText('b-model-name', m.name || '-');
        setText('b-algorithm', formatAlgo(m.algorithm));
        setText('b-version', m.version || '1.0');
        setText('b-created', m.created_at ? new Date(m.created_at).toLocaleDateString() : '-');
    }

    function setText(id, val) {
        const el = document.getElementById(id);
        if (el) el.textContent = val;
    }

    function formatAlgo(name) {
        if (!name) return '-';
        const map = { 'random_forest': 'Random Forest', 'xgboost': 'XGBoost', 'lightgbm': 'LightGBM', 'gradient_boosting': 'Gradient Boosting' };
        return map[name] || name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    }

    // Auto-load on page show
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(m) {
            if (m.target.id === 'page-ml-benefits' && m.target.style.display !== 'none') {
                loadBenefitsReport();
            }
        });
    });

    const page = document.getElementById('page-ml-benefits');
    if (page) observer.observe(page, { attributes: true, attributeFilter: ['style'] });
})();
</script>
