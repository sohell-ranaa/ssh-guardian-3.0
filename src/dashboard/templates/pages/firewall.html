<!-- SSH Guardian v3.0 - Firewall Management Page -->
<div id="page-firewall" class="page-content" style="display: none;">
    <div class="page-header-with-cache">
        <div>
            <h1 class="page-title">Firewall Management</h1>
            <p class="page-subtitle">View and manage iptables rules on remote agents</p>
        </div>
        <div class="page-header-actions">
            <div class="cache-indicator loading" data-cache-endpoint="firewall">
                <span class="cache-status-dot"></span>
                <span class="cache-indicator-text">Loading...</span>
                <span class="cache-time"></span>
                <button class="cache-refresh-btn" onclick="loadFirewallPage()" title="Refresh data">‚Üª</button>
            </div>
        </div>
    </div>

    <!-- Agent Selector -->
    <div class="card" style="margin-bottom: 20px;">
        <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
            <div style="flex: 1; min-width: 250px;">
                <label style="display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px;">Select Agent</label>
                <select id="firewallAgentSelector" style="width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 2px; font-size: 14px; background: var(--surface);">
                    <option value="">-- Select an agent --</option>
                </select>
            </div>
            <div style="display: flex; gap: 8px; align-items: flex-end;">
                <button id="syncFirewallNow" disabled style="padding: 10px 16px; background: var(--azure-blue); color: white; border: none; border-radius: 2px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 6px;">
                    <span>üîÑ</span> Sync Now
                </button>
                <button id="saveFirewallRules" disabled style="padding: 10px 16px; background: #107C10; color: white; border: none; border-radius: 2px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 6px;">
                    <span>üíæ</span> Save Rules
                </button>
            </div>
        </div>
    </div>

    <!-- No Agent Selected Message -->
    <div id="firewallNoAgent" class="card" style="text-align: center; padding: 60px 20px;">
        <div style="font-size: 48px; margin-bottom: 16px;">üî•</div>
        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Select an Agent</h3>
        <p style="color: var(--text-secondary); font-size: 14px;">Choose an agent from the dropdown above to view and manage its firewall rules.</p>
    </div>

    <!-- Firewall Content (Hidden until agent selected) -->
    <div id="firewallContent" style="display: none;">
        <!-- Firewall Status -->
        <div class="stats-grid" id="firewallStats" style="margin-bottom: 20px;">
            <div class="stat-card">
                <div class="stat-value" id="stat-fw-status">-</div>
                <div class="stat-label">Firewall Status</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-fw-rules">-</div>
                <div class="stat-label">Total Rules</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-fw-forwards">-</div>
                <div class="stat-label">Port Forwards</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-fw-sync">-</div>
                <div class="stat-label">Last Sync</div>
            </div>
        </div>

        <!-- Chain Policies -->
        <div class="card" style="margin-bottom: 20px;">
            <div class="card-title" style="margin-bottom: 16px;">Default Chain Policies</div>
            <div id="chainPolicies" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                <!-- Policies will be populated here -->
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="card" style="margin-bottom: 0; border-bottom: none; border-radius: 4px 4px 0 0;">
            <div style="display: flex; gap: 0; border-bottom: 1px solid var(--border); flex-wrap: wrap;">
                <button class="fw-tab-btn active" data-tab="rules" style="padding: 12px 24px; background: none; border: none; cursor: pointer; font-size: 14px; font-weight: 500; border-bottom: 2px solid var(--azure-blue); margin-bottom: -1px;">
                    üìã Rules
                </button>
                <button class="fw-tab-btn" data-tab="port-forwards" style="padding: 12px 24px; background: none; border: none; cursor: pointer; font-size: 14px; font-weight: 500; color: var(--text-secondary);">
                    üîÄ Port Forwards
                </button>
                <button class="fw-tab-btn" data-tab="ports" style="padding: 12px 24px; background: none; border: none; cursor: pointer; font-size: 14px; font-weight: 500; color: var(--text-secondary);">
                    üîå Listening Ports
                </button>
                <button class="fw-tab-btn" data-tab="users" style="padding: 12px 24px; background: none; border: none; cursor: pointer; font-size: 14px; font-weight: 500; color: var(--text-secondary);">
                    üë• Users
                </button>
                <button class="fw-tab-btn" data-tab="suggestions" style="padding: 12px 24px; background: none; border: none; cursor: pointer; font-size: 14px; font-weight: 500; color: var(--text-secondary); position: relative;">
                    üí° Suggestions
                    <span id="suggestionsCount" style="display: none; position: absolute; top: 6px; right: 6px; background: #D13438; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px;"></span>
                </button>
                <button class="fw-tab-btn" data-tab="interfaces" style="padding: 12px 24px; background: none; border: none; cursor: pointer; font-size: 14px; font-weight: 500; color: var(--text-secondary);">
                    üåê Interfaces
                </button>
                <button class="fw-tab-btn" data-tab="commands" style="padding: 12px 24px; background: none; border: none; cursor: pointer; font-size: 14px; font-weight: 500; color: var(--text-secondary);">
                    üìù Commands
                </button>
            </div>
        </div>

        <!-- Rules Tab -->
        <div id="fw-tab-rules" class="fw-tab-content card" style="border-radius: 0 0 4px 4px; margin-bottom: 20px;">
            <!-- Quick Actions -->
            <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-bottom: 20px;">
                <button id="showAddRuleForm" style="padding: 8px 16px; background: var(--azure-blue); color: white; border: none; border-radius: 2px; cursor: pointer; font-size: 13px;">
                    ‚ûï Add Rule
                </button>
                <button id="showTemplates" style="padding: 8px 16px; background: var(--surface); border: 1px solid var(--border); border-radius: 2px; cursor: pointer; font-size: 13px;">
                    üìë Use Template
                </button>
                <div style="flex: 1;"></div>
                <select id="filterTable" style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    <option value="">All Tables</option>
                    <option value="filter">filter</option>
                    <option value="nat">nat</option>
                    <option value="mangle">mangle</option>
                    <option value="raw">raw</option>
                </select>
                <select id="filterChain" style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    <option value="">All Chains</option>
                    <option value="INPUT">INPUT</option>
                    <option value="OUTPUT">OUTPUT</option>
                    <option value="FORWARD">FORWARD</option>
                    <option value="PREROUTING">PREROUTING</option>
                    <option value="POSTROUTING">POSTROUTING</option>
                </select>
                <select id="filterTarget" style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    <option value="">All Targets</option>
                    <option value="ACCEPT">ACCEPT</option>
                    <option value="DROP">DROP</option>
                    <option value="REJECT">REJECT</option>
                    <option value="LOG">LOG</option>
                    <option value="DNAT">DNAT</option>
                    <option value="SNAT">SNAT</option>
                    <option value="MASQUERADE">MASQUERADE</option>
                </select>
            </div>

            <!-- Add Rule Form (Hidden) -->
            <div id="addRuleForm" style="display: none; background: var(--background); padding: 20px; border-radius: 4px; margin-bottom: 20px; border: 1px solid var(--border);">
                <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Add New Firewall Rule</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Table *</label>
                        <select id="ruleTable" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                            <option value="filter">filter</option>
                            <option value="nat">nat</option>
                            <option value="mangle">mangle</option>
                            <option value="raw">raw</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Chain *</label>
                        <select id="ruleChain" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                            <option value="INPUT">INPUT</option>
                            <option value="OUTPUT">OUTPUT</option>
                            <option value="FORWARD">FORWARD</option>
                            <option value="PREROUTING">PREROUTING</option>
                            <option value="POSTROUTING">POSTROUTING</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Target *</label>
                        <select id="ruleTarget" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                            <option value="ACCEPT">ACCEPT</option>
                            <option value="DROP">DROP</option>
                            <option value="REJECT">REJECT</option>
                            <option value="LOG">LOG</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Protocol</label>
                        <select id="ruleProtocol" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                            <option value="all">all</option>
                            <option value="tcp">tcp</option>
                            <option value="udp">udp</option>
                            <option value="icmp">icmp</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Source IP/CIDR</label>
                        <input type="text" id="ruleSource" placeholder="0.0.0.0/0" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Destination IP/CIDR</label>
                        <input type="text" id="ruleDestination" placeholder="0.0.0.0/0" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Destination Port</label>
                        <input type="text" id="ruleDport" placeholder="e.g., 22, 80, 443" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Input Interface</label>
                        <input type="text" id="ruleInInterface" placeholder="e.g., eth0" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Position</label>
                        <input type="number" id="rulePosition" placeholder="Append (leave empty)" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Comment</label>
                        <input type="text" id="ruleComment" placeholder="Optional description" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    </div>
                </div>
                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button id="submitAddRule" style="padding: 8px 20px; background: var(--azure-blue); color: white; border: none; border-radius: 2px; cursor: pointer; font-size: 13px;">
                        Add Rule
                    </button>
                    <button id="cancelAddRule" style="padding: 8px 20px; background: var(--surface); border: 1px solid var(--border); border-radius: 2px; cursor: pointer; font-size: 13px;">
                        Cancel
                    </button>
                </div>
                <div id="addRuleMessage" style="display: none; margin-top: 12px; padding: 10px; border-radius: 2px; font-size: 13px;"></div>
            </div>

            <!-- Rules Table -->
            <div id="rulesLoading" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                Loading firewall rules...
            </div>
            <div id="rulesTableContainer" style="display: none;">
                <div class="table-wrapper">
                    <table id="rulesTable" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: var(--background); border-bottom: 2px solid var(--border);">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Table</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Chain</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">#</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Target</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Protocol</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Source</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Destination</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Ports</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Packets</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="rulesTableBody">
                            <!-- Rules will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="rulesError" style="display: none; text-align: center; padding: 40px; color: #D13438;">
                Error loading firewall rules
            </div>
        </div>

        <!-- Port Forwards Tab -->
        <div id="fw-tab-port-forwards" class="fw-tab-content card" style="display: none; border-radius: 0 0 4px 4px; margin-bottom: 20px;">
            <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-bottom: 20px;">
                <button id="showAddPortForward" style="padding: 8px 16px; background: var(--azure-blue); color: white; border: none; border-radius: 2px; cursor: pointer; font-size: 13px;">
                    ‚ûï Add Port Forward
                </button>
            </div>

            <!-- Add Port Forward Form (Hidden) -->
            <div id="addPortForwardForm" style="display: none; background: var(--background); padding: 20px; border-radius: 4px; margin-bottom: 20px; border: 1px solid var(--border);">
                <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Add Port Forward</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px;">
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">External Port *</label>
                        <input type="number" id="pfExternalPort" placeholder="8080" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Internal IP *</label>
                        <input type="text" id="pfInternalIP" placeholder="192.168.1.100" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Internal Port *</label>
                        <input type="number" id="pfInternalPort" placeholder="80" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Protocol</label>
                        <select id="pfProtocol" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                            <option value="tcp">TCP</option>
                            <option value="udp">UDP</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">Interface (optional)</label>
                        <input type="text" id="pfInterface" placeholder="eth0" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                    </div>
                </div>
                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button id="submitPortForward" style="padding: 8px 20px; background: var(--azure-blue); color: white; border: none; border-radius: 2px; cursor: pointer; font-size: 13px;">
                        Add Port Forward
                    </button>
                    <button id="cancelPortForward" style="padding: 8px 20px; background: var(--surface); border: 1px solid var(--border); border-radius: 2px; cursor: pointer; font-size: 13px;">
                        Cancel
                    </button>
                </div>
                <div id="addPFMessage" style="display: none; margin-top: 12px; padding: 10px; border-radius: 2px; font-size: 13px;"></div>
            </div>

            <!-- Port Forwards Table -->
            <div id="portForwardsLoading" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                Loading port forwards...
            </div>
            <div id="portForwardsTableContainer" style="display: none;">
                <div class="table-wrapper">
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: var(--background); border-bottom: 2px solid var(--border);">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">External Port</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Internal IP</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Internal Port</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Protocol</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Interface</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="portForwardsTableBody">
                            <!-- Port forwards will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="noPortForwards" style="display: none; text-align: center; padding: 40px; color: var(--text-secondary);">
                <div style="font-size: 32px; margin-bottom: 12px;">üîÄ</div>
                <p>No port forwards configured</p>
            </div>
        </div>

        <!-- Listening Ports Tab -->
        <div id="fw-tab-ports" class="fw-tab-content card" style="display: none; border-radius: 0 0 4px 4px; margin-bottom: 20px;">
            <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-bottom: 20px;">
                <div style="display: flex; gap: 8px; align-items: center;">
                    <label style="font-size: 13px;">Show:</label>
                    <select id="portsFilter" style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                        <option value="all">All Ports</option>
                        <option value="protected">Protected Only</option>
                    </select>
                </div>
                <div style="flex: 1;"></div>
                <div style="font-size: 13px; color: var(--text-secondary);">
                    <span id="listeningPortsCount">0</span> listening, <span id="protectedPortsCount">0</span> protected
                </div>
            </div>
            <div id="portsLoading" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                Loading listening ports...
            </div>
            <div id="portsTableContainer" style="display: none;">
                <div class="table-wrapper">
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: var(--background); border-bottom: 2px solid var(--border);">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Port</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Protocol</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Address</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Process</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">User</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="portsTableBody">
                            <!-- Ports will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="noPorts" style="display: none; text-align: center; padding: 40px; color: var(--text-secondary);">
                <div style="font-size: 32px; margin-bottom: 12px;">üîå</div>
                <p>No listening ports detected</p>
            </div>
        </div>

        <!-- System Users Tab -->
        <div id="fw-tab-users" class="fw-tab-content card" style="display: none; border-radius: 0 0 4px 4px; margin-bottom: 20px;">
            <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-bottom: 20px;">
                <div style="display: flex; gap: 8px; align-items: center;">
                    <label style="font-size: 13px;">Show:</label>
                    <select id="usersFilter" style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                        <option value="login">Login-Enabled Only</option>
                        <option value="all">All Users</option>
                    </select>
                </div>
                <div style="flex: 1;"></div>
                <div style="font-size: 13px; color: var(--text-secondary);">
                    <span id="loginUsersCount">0</span> login-enabled users
                </div>
            </div>
            <div id="usersLoading" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                Loading system users...
            </div>
            <div id="usersTableContainer" style="display: none;">
                <div class="table-wrapper">
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: var(--background); border-bottom: 2px solid var(--border);">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Username</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">UID</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Home</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Shell</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Groups</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Last Login</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Type</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="noUsers" style="display: none; text-align: center; padding: 40px; color: var(--text-secondary);">
                <div style="font-size: 32px; margin-bottom: 12px;">üë•</div>
                <p>No users found</p>
            </div>
        </div>

        <!-- Suggestions Tab -->
        <div id="fw-tab-suggestions" class="fw-tab-content card" style="display: none; border-radius: 0 0 4px 4px; margin-bottom: 20px;">
            <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-bottom: 20px;">
                <div style="display: flex; gap: 8px; align-items: center;">
                    <label style="font-size: 13px;">Priority:</label>
                    <select id="suggestionsFilter" style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px;">
                        <option value="all">All</option>
                        <option value="high">High Priority</option>
                        <option value="medium">Medium Priority</option>
                        <option value="low">Low Priority</option>
                    </select>
                </div>
                <button id="refreshSuggestions" style="padding: 8px 16px; background: var(--surface); border: 1px solid var(--border); border-radius: 2px; cursor: pointer; font-size: 13px;">
                    üîÑ Refresh
                </button>
                <div style="flex: 1;"></div>
                <div style="font-size: 13px; color: var(--text-secondary);">
                    <span id="pendingSuggestionsCount">0</span> pending suggestions
                </div>
            </div>
            <div id="suggestionsLoading" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                Loading suggestions...
            </div>
            <div id="suggestionsContainer" style="display: none;">
                <div id="suggestionsList" style="display: grid; gap: 16px;">
                    <!-- Suggestions will be inserted here -->
                </div>
            </div>
            <div id="noSuggestions" style="display: none; text-align: center; padding: 40px; color: var(--text-secondary);">
                <div style="font-size: 32px; margin-bottom: 12px;">‚úÖ</div>
                <p>No pending suggestions - your firewall configuration looks good!</p>
            </div>
        </div>

        <!-- Interfaces Tab -->
        <div id="fw-tab-interfaces" class="fw-tab-content card" style="display: none; border-radius: 0 0 4px 4px; margin-bottom: 20px;">
            <div id="interfacesLoading" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                Loading network interfaces...
            </div>
            <div id="interfacesContainer" style="display: none;">
                <div id="interfacesGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
                    <!-- Interfaces will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Command History Tab -->
        <div id="fw-tab-commands" class="fw-tab-content card" style="display: none; border-radius: 0 0 4px 4px; margin-bottom: 20px;">
            <div id="commandsLoading" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                Loading command history...
            </div>
            <div id="commandsTableContainer" style="display: none;">
                <div class="table-wrapper">
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: var(--background); border-bottom: 2px solid var(--border);">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Created</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Action</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Parameters</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Result</th>
                            </tr>
                        </thead>
                        <tbody id="commandsTableBody">
                            <!-- Commands will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="noCommands" style="display: none; text-align: center; padding: 40px; color: var(--text-secondary);">
                <div style="font-size: 32px; margin-bottom: 12px;">üìù</div>
                <p>No command history</p>
            </div>
        </div>
    </div>
</div>

<!-- Rule Templates Modal -->
<div id="templatesModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: var(--surface); border-radius: 4px; padding: 24px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="font-size: 16px; font-weight: 600;">Rule Templates</h3>
            <button id="closeTemplatesModal" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-secondary);">√ó</button>
        </div>
        <div id="templatesList" style="display: grid; gap: 12px;">
            <!-- Templates will be inserted here -->
        </div>
    </div>
</div>
