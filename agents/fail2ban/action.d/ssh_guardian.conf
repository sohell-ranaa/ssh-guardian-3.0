# SSH Guardian fail2ban Action
# Reports ban/unban events to SSH Guardian central server
#
# Usage in jail.local:
#   action = iptables-multiport[name=sshd, port="ssh"]
#            ssh_guardian[server_url=https://your-server:8081, api_key=YOUR_API_KEY, agent_id=YOUR_AGENT_ID]

[Definition]

# Ban action - report to SSH Guardian server
actionban = /usr/bin/curl -s -X POST "<server_url>/api/agents/fail2ban/ban" \
            -H "X-API-Key: <api_key>" \
            -H "Content-Type: application/json" \
            -d '{"ip": "<ip>", "jail": "<name>", "agent_id": "<agent_id>", "action": "ban", "failures": <failures>, "bantime": <bantime>}' \
            --connect-timeout 5 \
            --max-time 10 \
            || echo "SSH Guardian: Failed to report ban for <ip>"

# Unban action - report to SSH Guardian server
actionunban = /usr/bin/curl -s -X POST "<server_url>/api/agents/fail2ban/unban" \
              -H "X-API-Key: <api_key>" \
              -H "Content-Type: application/json" \
              -d '{"ip": "<ip>", "jail": "<name>", "agent_id": "<agent_id>", "action": "unban"}' \
              --connect-timeout 5 \
              --max-time 10 \
              || echo "SSH Guardian: Failed to report unban for <ip>"

# Start action (optional - when fail2ban starts)
actionstart =

# Stop action (optional - when fail2ban stops)
actionstop =

# Check action (optional - verify action works)
actioncheck =

[Init]

# Default values (override in jail config)
server_url = http://localhost:8081
api_key =
agent_id =
